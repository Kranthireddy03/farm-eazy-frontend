{"version":3,"file":"Checkout-Dv_dWjxr.js","sources":["../../src/pages/Checkout.jsx"],"sourcesContent":["import { useState, useEffect } from 'react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport { useToast } from '../hooks/useToast'\r\nimport apiClient from '../services/apiClient'\r\n\r\n// Razorpay script loader\r\nfunction loadRazorpayScript() {\r\n  return new Promise((resolve) => {\r\n    if (window.Razorpay) return resolve(true);\r\n    const script = document.createElement('script');\r\n    script.src = 'https://checkout.razorpay.com/v1/checkout.js';\r\n    script.onload = () => resolve(true);\r\n    script.onerror = () => resolve(false);\r\n    document.body.appendChild(script);\r\n  });\r\n}\r\n\r\nfunction Checkout() {\r\n  // Add missing handleRetryPayment function\r\n  const handleRetryPayment = () => {\r\n    console.log(\"Retry payment clicked\");\r\n    // Re-invoke Razorpay payment flow for pending order\r\n    // You may want to call the backend to get the pending order details and re-initiate payment\r\n    // For now, just reload the page or re-run handleCheckout\r\n    handleCheckout();\r\n  };\r\n    // Loads cart, coins, and addresses for checkout page\r\n    const loadCheckoutData = async () => {\r\n      try {\r\n        // Load cart from localStorage\r\n        const cart = JSON.parse(localStorage.getItem('farmeazy_cart') || '[]');\r\n        setCartItems(cart);\r\n        // Fetch coins\r\n        await fetchCoins();\r\n        // Fetch addresses\r\n        await fetchAddresses();\r\n      } catch (error) {\r\n        showToast('Failed to load checkout data', 'error');\r\n      }\r\n    };\r\n  // State for payment retry logic\r\n  const [pendingOrderId, setPendingOrderId] = useState(null);\r\n  const [retryTimer, setRetryTimer] = useState(0);\r\n  const [retryInterval, setRetryInterval] = useState(null);\r\n  const [retryActive, setRetryActive] = useState(false);\r\n\r\n  const navigate = useNavigate()\r\n  const { showToast } = useToast()\r\n\r\n  const [cartItems, setCartItems] = useState([])\r\n  const [coins, setCoins] = useState(0)\r\n  const [useCoins, setUseCoins] = useState(false)\r\n  const [coinsToUse, setCoinsToUse] = useState(0)\r\n    // Restore coin discount UI logic\r\n    const handleCoinToggle = () => {\r\n      setUseCoins(!useCoins);\r\n      if (!useCoins) {\r\n        setCoinsToUse(Math.min(coins, Math.floor(total)));\r\n      } else {\r\n        setCoinsToUse(0);\r\n      }\r\n    };\r\n\r\n    const handleCoinsToUseChange = (e) => {\r\n      const value = Math.max(0, Math.min(Number(e.target.value), Math.min(coins, Math.floor(total))));\r\n      setCoinsToUse(value);\r\n    };\r\n  const [selectedPayment, setSelectedPayment] = useState('CASH_ON_DELIVERY')\r\n  const [razorpayLoading, setRazorpayLoading] = useState(false)\r\n  const [checkingOut, setCheckingOut] = useState(false)\r\n  const [showAddressForm, setShowAddressForm] = useState(false)\r\n  const [addresses, setAddresses] = useState([])\r\n  const [selectedAddress, setSelectedAddress] = useState(null)\r\n\r\n  const [addressForm, setAddressForm] = useState({\r\n    fullName: '',\r\n    phoneNumber: '',\r\n    email: '',\r\n    addressLine1: '',\r\n    addressLine2: '',\r\n    landmark: '',\r\n    addressType: '',\r\n    city: '',\r\n    state: '',\r\n    postalCode: ''\r\n  })\r\n\r\n  const UPI_ID = '6301630368@ybl'\r\n  const PHONE_PAY_ID = '6301630368'\r\n  const TAX_RATE = 0.18\r\n  const COIN_VALUE = 1\r\n\r\n  useEffect(() => {\r\n    loadCheckoutData()\r\n  }, [])\r\n\r\n  // Cleanup retry interval on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (retryInterval) clearInterval(retryInterval);\r\n    };\r\n  }, [retryInterval]);\r\n\r\n  // Retry Screen at top of render\r\n  if (retryActive && pendingOrderId) {\r\n    return (\r\n      <div className=\"min-h-screen flex flex-col items-center justify-center bg-amber-900/30\">\r\n        <div className=\"bg-slate-800 rounded-lg shadow-lg p-8 max-w-md w-full text-center border border-slate-700\">\r\n          <h2 className=\"text-2xl font-bold text-amber-400 mb-4\">Order On Hold</h2>\r\n          <p className=\"mb-2 text-slate-300\">Your order is on hold due to payment failure.</p>\r\n          <p className=\"mb-4 text-slate-300\">\r\n            You have \r\n            <span className=\"font-bold text-white\">\r\n              {Math.floor(retryTimer/60)}:\r\n              {(retryTimer % 60).toString().padStart(2, '0')}\r\n            </span> \r\n            minutes to retry payment.\r\n          </p>\r\n          <button\r\n            onClick={handleRetryPayment}\r\n            className=\"bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition mb-2\"\r\n            disabled={razorpayLoading}\r\n          >\r\n            Retry Payment\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              setRetryActive(false);\r\n              navigate('/');\r\n            }}\r\n            className=\"bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded-lg transition\"\r\n          >\r\n            Cancel Order\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const fetchCoins = async () => {\r\n    try {\r\n      const response = await apiClient.get('/coins')\r\n      setCoins(response.data.totalCoins || 0)\r\n    } catch (error) {\r\n      console.error('Error fetching coins:', error)\r\n    }\r\n  }\r\n\r\n  const fetchAddresses = async () => {\r\n    try {\r\n      const response = await apiClient.get('/addresses')\r\n      const addressList = Array.isArray(response.data) ? response.data : []\r\n      setAddresses(addressList)\r\n      if (addressList.length > 0) {\r\n        setSelectedAddress(addressList[0].id)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching addresses:', error)\r\n    }\r\n  }\r\n\r\n  const calculateTotals = () => {\r\n    const subtotal = cartItems.reduce((sum, item) => {\r\n      // Use discounted price if available, otherwise use regular price\r\n      const itemPrice = (item.discountedPrice && item.discountedPrice > 0) ? item.discountedPrice : item.price\r\n      return sum + (itemPrice * item.quantity)\r\n    }, 0)\r\n    const tax = subtotal * TAX_RATE\r\n    const total = subtotal + tax\r\n    return { subtotal, tax, total }\r\n  }\r\n\r\n  const { subtotal, tax, total } = calculateTotals();\r\n  const maxCoinsUsable = Math.min(coins, Math.floor(total));\r\n  const coinsApplied = useCoins ? Math.min(coinsToUse, maxCoinsUsable) : 0;\r\n  const finalAmount = Math.max(0, total - (coinsApplied * COIN_VALUE));\r\n\r\n  const handleAddressChange = (e) => {\r\n    const { name, value } = e.target\r\n    setAddressForm({ ...addressForm, [name]: value })\r\n  }\r\n\r\n  const handleAddressSubmit = async (e) => {\r\n    e.preventDefault()\r\n    try {\r\n      const response = await apiClient.post('/addresses', addressForm)\r\n      showToast('Address added successfully', 'success')\r\n      setAddressForm({\r\n        fullName: '',\r\n        phoneNumber: '',\r\n        email: '',\r\n        addressLine1: '',\r\n        addressLine2: '',\r\n        city: '',\r\n        state: '',\r\n        postalCode: ''\r\n      })\r\n      setShowAddressForm(false)\r\n      fetchAddresses()\r\n    } catch (error) {\r\n      showToast('Failed to add address', 'error')\r\n    }\r\n  }\r\n\r\n  const handleCheckout = async () => {\r\n    console.log('[DEBUG] Checkout triggered. Cart:', cartItems, 'Coins:', coins, 'UseCoins:', useCoins, 'CoinsToUse:', coinsToUse, 'CoinsApplied:', coinsApplied, 'FinalAmount:', finalAmount, 'SelectedPayment:', selectedPayment);\r\n    try {\r\n      setCheckingOut(true)\r\n\r\n      // Require an address for all payment methods\r\n      if (!selectedAddress) {\r\n        showToast('Please select or add a delivery address', 'warning')\r\n        setCheckingOut(false)\r\n        return\r\n      }\r\n\r\n      // Razorpay flow\r\n      if (selectedPayment === 'RAZORPAY') {\r\n        const MIN_PAYABLE = 1;\r\n        if (finalAmount < MIN_PAYABLE) {\r\n          alert('Minimum payable amount is ‚Çπ1');\r\n          setRazorpayLoading(false);\r\n          setCheckingOut(false);\r\n          return;\r\n        }\r\n        setRazorpayLoading(true);\r\n        const loaded = await loadRazorpayScript();\r\n        if (!loaded) {\r\n          showToast('Failed to load Razorpay. Please try again.', 'error');\r\n          setRazorpayLoading(false);\r\n          setCheckingOut(false);\r\n          return;\r\n        }\r\n        // Create Razorpay order on backend (amount in paise)\r\n        const paymentData = {\r\n          amount: Math.round(finalAmount * 100), // in paise\r\n          email: addresses.find(a => a.id === selectedAddress)?.email || '',\r\n          phone: addresses.find(a => a.id === selectedAddress)?.phoneNumber || ''\r\n        };\r\n        console.log('[DEBUG] Creating Razorpay order with:', paymentData, `(Rupees: ‚Çπ${finalAmount}, Paise: ${Math.round(finalAmount * 100)})`);\r\n        const orderRes = await apiClient.post('/api/payment/create-order', paymentData);\r\n        if (orderRes.status !== 200) {\r\n          console.error('Backend order creation failed:', orderRes);\r\n          showToast('Order creation failed: ' + (orderRes.data || orderRes.statusText), 'error');\r\n          setRazorpayLoading(false);\r\n          setCheckingOut(false);\r\n          return;\r\n        }\r\n        const order = orderRes.data;\r\n        console.log('[DEBUG] Razorpay order response:', order);\r\n\r\n        const options = {\r\n          key: order.key_id,\r\n          amount: order.amount, // in paise\r\n          currency: order.currency,\r\n          name: 'FarmEazy',\r\n          description: 'Order Payment',\r\n          order_id: order.id,\r\n          handler: async function (response) {\r\n            console.log('[DEBUG] Razorpay handler response:', response);\r\n            // Verify payment on backend\r\n            try {\r\n              const verifyResult = await apiClient.post('/payment/verify', {\r\n                orderId: order.id,\r\n                paymentId: response.razorpay_payment_id,\r\n                signature: response.razorpay_signature,\r\n                email: paymentData.email,\r\n                phone: paymentData.phone\r\n              });\r\n              console.log('[DEBUG] Payment verify result:', verifyResult.data);\r\n              // Only after payment is verified, place the order\r\n              if (verifyResult.data.status === 'success') {\r\n                const orderData = {\r\n                  items: cartItems.map(item => {\r\n                    const itemPrice = (item.discountedPrice && item.discountedPrice > 0) ? item.discountedPrice : item.price;\r\n                    return {\r\n                      productId: item.id,\r\n                      quantity: item.quantity,\r\n                      price: itemPrice\r\n                    };\r\n                  }),\r\n                  subtotal: subtotal,\r\n                  taxAmount: tax,\r\n                  totalAmount: total,\r\n                  coinsUsed: coinsApplied,\r\n                  finalAmount: finalAmount,\r\n                  paymentMethod: 'RAZORPAY',\r\n                  addressId: selectedAddress,\r\n                  paymentId: response.razorpay_payment_id\r\n                };\r\n                console.log('[DEBUG] Placing order after payment success:', orderData);\r\n                const placedOrder = await apiClient.post('/orders', orderData);\r\n                localStorage.removeItem('farmeazy_cart');\r\n                localStorage.removeItem('farmeazy_checkout_coins');\r\n                showToast('‚úÖ Payment successful & order placed!', 'success');\r\n                navigate(`/order-confirmation/${placedOrder.data.id}`);\r\n              } else {\r\n                // Payment failed, create pending order and allow retry\r\n                const failedOrderData = {\r\n                  items: cartItems.map(item => {\r\n                    const itemPrice = (item.discountedPrice && item.discountedPrice > 0) ? item.discountedPrice : item.price;\r\n                    return {\r\n                      productId: item.id,\r\n                      quantity: item.quantity,\r\n                      price: itemPrice\r\n                    };\r\n                  }),\r\n                  subtotal: subtotal,\r\n                  taxAmount: tax,\r\n                  totalAmount: total,\r\n                  coinsUsed: coinsApplied,\r\n                  finalAmount: finalAmount,\r\n                  paymentMethod: 'RAZORPAY',\r\n                  addressId: selectedAddress,\r\n                  paymentStatus: 'FAILED',\r\n                  orderStatus: 'PENDING',\r\n                  paymentId: response.razorpay_payment_id\r\n                };\r\n                console.log('[DEBUG] Creating pending order after payment failure:', failedOrderData);\r\n                const pendingOrder = await apiClient.post('/orders', failedOrderData);\r\n                setPendingOrderId(pendingOrder.data.id);\r\n                setRetryActive(true);\r\n                setRetryTimer(600); // 10 minutes\r\n                showToast('Payment failed. Order is on hold for 10 minutes. You can retry payment.', 'warning');\r\n              }\r\n            } catch (err) {\r\n              console.error('[DEBUG] Payment verification failed:', err);\r\n              showToast('Payment verification failed. Contact support.', 'error');\r\n            }\r\n          },\r\n          prefill: {\r\n            email: paymentData.email,\r\n            contact: paymentData.phone\r\n          },\r\n          theme: { color: '#22c55e' },\r\n          modal: {\r\n            ondismiss: async function () {\r\n              // Payment failed or closed, create pending order and start retry timer\r\n              const failedOrderData = {\r\n                items: cartItems.map(item => {\r\n                  const itemPrice = (item.discountedPrice && item.discountedPrice > 0) ? item.discountedPrice : item.price\r\n                  return {\r\n                    productId: item.id,\r\n                    quantity: item.quantity,\r\n                    price: itemPrice\r\n                  }\r\n                }),\r\n                subtotal: subtotal,\r\n                taxAmount: tax,\r\n                totalAmount: total,\r\n                coinsUsed: coinsApplied,\r\n                finalAmount: finalAmount,\r\n                paymentMethod: 'RAZORPAY',\r\n                addressId: selectedAddress,\r\n                paymentStatus: 'FAILED',\r\n                orderStatus: 'PENDING'\r\n              };\r\n              try {\r\n                const pendingOrder = await apiClient.post('/orders', failedOrderData);\r\n                setPendingOrderId(pendingOrder.data.id);\r\n                setRetryActive(true);\r\n                setRetryTimer(600); // 10 minutes in seconds\r\n                showToast('Payment failed. Order is on hold for 10 minutes. You can retry payment.', 'warning');\r\n                // Start timer\r\n                if (retryInterval) clearInterval(retryInterval);\r\n                const interval = setInterval(() => {\r\n                  setRetryTimer(prev => {\r\n                    if (prev <= 1) {\r\n                      clearInterval(interval);\r\n                      setRetryActive(false);\r\n                      // Optionally call backend to cancel order\r\n                      apiClient.patch(`/orders/${pendingOrder.data.id}/cancel`);\r\n                      showToast('Order cancelled due to payment timeout.', 'error');\r\n                      return 0;\r\n                    }\r\n                    return prev - 1;\r\n                  });\r\n                }, 1000);\r\n                setRetryInterval(interval);\r\n              } catch (err) {\r\n                showToast('Failed to create pending order.', 'error');\r\n              }\r\n            }\r\n          }\r\n        };\r\n        const rzp = new window.Razorpay(options);\r\n        rzp.open();\r\n      }\r\n\r\n      // Default flow for other payment methods\r\n      if (selectedPayment === 'CASH_ON_DELIVERY') {\r\n        const orderData = {\r\n          items: cartItems.map(item => {\r\n            const itemPrice = (item.discountedPrice && item.discountedPrice > 0) ? item.discountedPrice : item.price\r\n            return {\r\n              productId: item.id,\r\n              quantity: item.quantity,\r\n              price: itemPrice\r\n            }\r\n          }),\r\n          subtotal: subtotal,\r\n          taxAmount: tax,\r\n          totalAmount: total,\r\n          coinsUsed: coinsApplied,\r\n          finalAmount: finalAmount,\r\n          paymentMethod: 'CASH_ON_DELIVERY',\r\n          addressId: selectedAddress\r\n        }\r\n        const response = await apiClient.post('/orders', orderData)\r\n        localStorage.removeItem('farmeazy_cart')\r\n        localStorage.removeItem('farmeazy_checkout_coins')\r\n        showToast('‚úÖ Order placed successfully!', 'success')\r\n        navigate(`/order-confirmation/${response.data.id}`)\r\n      }\r\n    } catch (error) {\r\n      showToast('Failed to place order: ' + error.message, 'error')\r\n      setRazorpayLoading(false)\r\n    } finally {\r\n      setCheckingOut(false)\r\n    }\r\n  }\r\n\r\n  const openUPIPayment = (orderId) => {\r\n    const upiLink = `upi://pay?pa=${UPI_ID}&pn=FarmEazy&tr=ORD${orderId}&am=${total}`\r\n    window.location.href = upiLink\r\n  }\r\n\r\n  const openPhonePayPayment = (orderId) => {\r\n    // Would integrate with PhonePay API\r\n    showToast('Redirecting to PhonePay...', 'info')\r\n    // window.location.href = `https://phonepay-api.example.com/pay?amount=${total}&orderId=${orderId}`\r\n  }\r\n\r\n  const copyUPI = () => {\r\n    navigator.clipboard.writeText(UPI_ID)\r\n    showToast('UPI ID copied to clipboard!', 'success')\r\n  }\r\n\r\n  const copyPhonePay = () => {\r\n    navigator.clipboard.writeText(PHONE_PAY_ID)\r\n    showToast('PhonePay ID copied to clipboard!', 'success')\r\n  }\r\n\r\n  if (cartItems.length === 0) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 py-8 px-4\">\r\n        <div className=\"max-w-2xl mx-auto text-center py-16\">\r\n          <p className=\"text-6xl mb-4\">üõí</p>\r\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Your Cart is Empty</h1>\r\n          <p className=\"text-slate-400 mb-8\">Add products to proceed with checkout</p>\r\n          <button\r\n            onClick={() => navigate('/buying')}\r\n            className=\"bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition\"\r\n          >\r\n            Continue Shopping\r\n          </button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 py-8 px-4\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <h1 className=\"text-4xl font-bold text-white mb-2\">üõçÔ∏è Checkout</h1>\r\n        <p className=\"text-slate-400 mb-8\">Complete your order securely</p>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n          {/* Main Checkout */}\r\n          <div className=\"lg:col-span-2 space-y-6\">\r\n            {/* Order Items Review */}\r\n            <div className=\"bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700\">\r\n              <h2 className=\"text-2xl font-bold text-white mb-4\">Order Summary</h2>\r\n              <div className=\"space-y-4\">\r\n                {cartItems.map(item => {\r\n                  const itemPrice = (item.discountedPrice && item.discountedPrice > 0) ? item.discountedPrice : item.price\r\n                  const hasDiscount = item.discountPercentage && item.discountPercentage > 0\r\n\r\n                  return (\r\n                    <div key={item.id} className=\"flex justify-between items-start pb-4 border-b border-slate-700\">\r\n                      <div className=\"flex-1\">\r\n                        <p className=\"font-semibold text-white\">{item.productName}</p>\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          {hasDiscount ? (\r\n                            <>\r\n                              <p className=\"text-sm text-slate-400\">Qty: {item.quantity} √ó ‚Çπ{itemPrice.toFixed(2)}</p>\r\n                              <span className=\"line-through text-slate-500 text-xs\">‚Çπ{item.price.toFixed(2)}</span>\r\n                              <span className=\"bg-green-600 text-white text-xs font-bold px-1.5 py-0.5 rounded\">\r\n                                {item.discountPercentage}% OFF\r\n                              </span>\r\n                            </>\r\n                          ) : (\r\n                            <p className=\"text-sm text-slate-400\">Qty: {item.quantity} √ó ‚Çπ{item.price.toFixed(2)}</p>\r\n                          )}\r\n                        </div>\r\n                        {hasDiscount && (\r\n                          <p className=\"text-xs text-green-400 font-semibold mt-1\">\r\n                            Saving ‚Çπ{((item.price - itemPrice) * item.quantity).toFixed(2)}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                      <p className=\"font-bold text-white\">‚Çπ{(itemPrice * item.quantity).toFixed(2)}</p>\r\n                    </div>\r\n                  )\r\n                })}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Payment Methods */}\r\n            <div className=\"bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700\">\r\n              <h2 className=\"text-2xl font-bold text-white mb-4\">üí≥ Payment Method</h2>\r\n              <div className=\"space-y-3\">\r\n                {/* Cash on Delivery */}\r\n                <label className=\"flex items-center p-4 border-2 rounded-lg cursor-pointer transition\"\r\n                       style={{ borderColor: selectedPayment === 'CASH_ON_DELIVERY' ? '#f97316' : '#475569',\r\n                               backgroundColor: selectedPayment === 'CASH_ON_DELIVERY' ? 'rgba(249, 115, 22, 0.1)' : 'transparent' }}>\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"payment\"\r\n                    value=\"CASH_ON_DELIVERY\"\r\n                    checked={selectedPayment === 'CASH_ON_DELIVERY'}\r\n                    onChange={(e) => setSelectedPayment(e.target.value)}\r\n                    className=\"w-4 h-4 cursor-pointer\"\r\n                  />\r\n                  <div className=\"ml-4\">\r\n                    <p className=\"font-semibold text-white\">üíµ Cash on Delivery</p>\r\n                    <p className=\"text-sm text-slate-400\">Pay when your order arrives</p>\r\n                    <p className=\"text-xs text-green-400 mt-1\">‚úì Free | Delivery in 3-5 days</p>\r\n                  </div>\r\n                </label>\r\n                {/* Razorpay */}\r\n                <label className=\"flex items-center p-4 border-2 rounded-lg cursor-pointer transition\"\r\n                       style={{ borderColor: selectedPayment === 'RAZORPAY' ? '#22c55e' : '#475569',\r\n                               backgroundColor: selectedPayment === 'RAZORPAY' ? 'rgba(34, 197, 94, 0.1)' : 'transparent' }}>\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"payment\"\r\n                    value=\"RAZORPAY\"\r\n                    checked={selectedPayment === 'RAZORPAY'}\r\n                    onChange={(e) => setSelectedPayment(e.target.value)}\r\n                    className=\"w-4 h-4 cursor-pointer\"\r\n                  />\r\n                  <div className=\"ml-4 flex-1\">\r\n                    <p className=\"font-semibold text-white\">ü™ô Razorpay (UPI/Card/Netbanking)</p>\r\n                    <p className=\"text-sm text-slate-400\">Pay securely online with Razorpay</p>\r\n                  </div>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Address selection & form */}\r\n            <div className=\"bg-slate-800 rounded-lg shadow-lg p-6 border border-slate-700\">\r\n              <h2 className=\"text-2xl font-bold text-white mb-4\">üìç Delivery Address</h2>\r\n\r\n              {addresses.length > 0 && (\r\n                <div className=\"mb-4\">\r\n                  <select\r\n                    value={selectedAddress || ''}\r\n                    onChange={(e) => setSelectedAddress(e.target.value)}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n                  >\r\n                    {addresses.map(addr => (\r\n                      <option key={addr.id} value={addr.id}>\r\n                        {addr.fullName} - {addr.addressLine1}, {addr.city}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              )}\r\n\r\n              <button\r\n                onClick={() => setShowAddressForm(!showAddressForm)}\r\n                className=\"w-full px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition font-semibold\"\r\n              >\r\n                {showAddressForm ? '‚ùå Cancel' : '‚ûï Add New Address'}\r\n              </button>\r\n\r\n              {showAddressForm && (\r\n                <form onSubmit={handleAddressSubmit} className=\"mt-4 space-y-3\">\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"fullName\"\r\n                    placeholder=\"Full Name (as per ID proof)\"\r\n                    value={addressForm.fullName}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white placeholder-slate-400 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <input\r\n                    type=\"email\"\r\n                    name=\"email\"\r\n                    placeholder=\"Email Address\"\r\n                    value={addressForm.email}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white placeholder-slate-400 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <input\r\n                    type=\"tel\"\r\n                    name=\"phoneNumber\"\r\n                    placeholder=\"10-digit Mobile Number\"\r\n                    pattern=\"[0-9]{10}\"\r\n                    value={addressForm.phoneNumber}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white placeholder-slate-400 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"addressLine1\"\r\n                    placeholder=\"Flat, House no., Building, Company, Apartment\"\r\n                    value={addressForm.addressLine1}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white placeholder-slate-400 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"addressLine2\"\r\n                    placeholder=\"Area, Street, Sector, Village (optional)\"\r\n                    value={addressForm.addressLine2}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white placeholder-slate-400 rounded-lg\"\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"landmark\"\r\n                    placeholder=\"Landmark (e.g. near temple, school)\"\r\n                    value={addressForm.landmark}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white placeholder-slate-400 rounded-lg\"\r\n                  />\r\n                  <select\r\n                    name=\"addressType\"\r\n                    value={addressForm.addressType}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 bg-slate-700 border border-slate-600 text-white rounded-lg\"\r\n                    required\r\n                  >\r\n                    <option value=\"\">Select Address Type</option>\r\n                    <option value=\"Home\">Home</option>\r\n                    <option value=\"Work\">Work</option>\r\n                    <option value=\"Other\">Other</option>\r\n                  </select>\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"city\"\r\n                    placeholder=\"City / Town\"\r\n                    value={addressForm.city}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"state\"\r\n                    placeholder=\"State / Province\"\r\n                    value={addressForm.state}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"postalCode\"\r\n                    placeholder=\"6-digit PIN Code\"\r\n                    pattern=\"[0-9]{6}\"\r\n                    value={addressForm.postalCode}\r\n                    onChange={handleAddressChange}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg\"\r\n                    required\r\n                  />\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold\"\r\n                  >\r\n                    Save Address\r\n                  </button>\r\n                </form>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Order Summary Sidebar */}\r\n          <div className=\"bg-slate-800 rounded-lg shadow-lg p-6 h-fit sticky top-20 border border-slate-700\">\r\n            <h2 className=\"text-2xl font-bold text-white mb-6\">Price Breakdown</h2>\r\n\r\n\r\n            <div className=\"space-y-3 border-b border-slate-600 pb-4 mb-4\">\r\n              <div className=\"flex justify-between text-slate-300\">\r\n                <span>Subtotal:</span>\r\n                <span className=\"font-semibold text-white\">‚Çπ{subtotal.toFixed(2)}</span>\r\n              </div>\r\n\r\n              {/* Coin discount UI */}\r\n              <div className=\"flex items-center gap-2 my-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={useCoins}\r\n                  onChange={handleCoinToggle}\r\n                  id=\"use-coins-toggle\"\r\n                  className=\"w-4 h-4\"\r\n                />\r\n                <label htmlFor=\"use-coins-toggle\" className=\"text-sm text-slate-300 font-semibold cursor-pointer\">\r\n                  Use Coins ({coins} available)\r\n                </label>\r\n                {useCoins && (\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"1\"\r\n                    max={maxCoinsUsable}\r\n                    value={coinsToUse}\r\n                    onChange={handleCoinsToUseChange}\r\n                    className=\"ml-2 px-2 py-1 bg-slate-700 border border-slate-600 text-white rounded w-20 text-right\"\r\n                  />\r\n                )}\r\n              </div>\r\n\r\n              {coinsApplied > 0 && (\r\n                <div className=\"flex justify-between text-green-400 font-semibold\">\r\n                  <span>ü™ô Coin Discount ({coinsApplied} coins):</span>\r\n                  <span>- ‚Çπ{(coinsApplied * COIN_VALUE).toFixed(2)}</span>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex justify-between text-slate-300\">\r\n                <span>Tax & Charges (18% GST):</span>\r\n                <span className=\"font-semibold text-white\">‚Çπ{tax.toFixed(2)}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between text-xl font-bold mb-6 text-green-400\">\r\n              <span>Final Amount:</span>\r\n              <span>‚Çπ{finalAmount.toFixed(2)}</span>\r\n            </div>\r\n\r\n            {coinsApplied > 0 && (\r\n              <div className=\"bg-green-900/30 border-l-4 border-green-500 p-3 mb-4 rounded\">\r\n                <p className=\"text-sm text-green-300 font-semibold\">üí∞ You're saving ‚Çπ{(coinsApplied * COIN_VALUE).toFixed(2)}</p>\r\n                <p className=\"text-xs text-green-400 mt-1\">Using {coinsApplied} coins for discount</p>\r\n              </div>\r\n            )}\r\n\r\n            {selectedPayment === 'CASH_ON_DELIVERY' && (\r\n              <div className=\"bg-blue-900/30 border-l-4 border-blue-500 p-3 mb-4 rounded\">\r\n                <p className=\"text-sm text-blue-300 font-semibold\">‚úì Cash on Delivery</p>\r\n                <p className=\"text-xs text-blue-400 mt-1\">Expected delivery: 3-5 business days</p>\r\n              </div>\r\n            )}\r\n\r\n            <button\r\n              onClick={handleCheckout}\r\n              disabled={checkingOut || (selectedPayment === 'CASH_ON_DELIVERY' && !selectedAddress)}\r\n              className=\"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-lg transition text-lg\"\r\n            >\r\n              {checkingOut ? (\r\n                <span className=\"flex items-center justify-center gap-2\">\r\n                  <span className=\"animate-spin\">‚è≥</span> Processing...\r\n                </span>\r\n              ) : (\r\n                '‚úì Place Order'\r\n              )}\r\n            </button>\r\n\r\n            <button\r\n              onClick={() => navigate('/cart')}\r\n              className=\"w-full mt-3 bg-slate-600 hover:bg-slate-500 text-white font-bold py-3 px-6 rounded-lg transition\"\r\n            >\r\n              Back to Cart\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Checkout\r\n"],"names":["loadRazorpayScript","resolve","script","Checkout","handleRetryPayment","handleCheckout","loadCheckoutData","cart","setCartItems","fetchCoins","fetchAddresses","showToast","pendingOrderId","setPendingOrderId","useState","retryTimer","setRetryTimer","retryInterval","setRetryInterval","retryActive","setRetryActive","navigate","useNavigate","useToast","cartItems","coins","setCoins","useCoins","setUseCoins","coinsToUse","setCoinsToUse","handleCoinToggle","total","handleCoinsToUseChange","e","value","selectedPayment","setSelectedPayment","razorpayLoading","setRazorpayLoading","checkingOut","setCheckingOut","showAddressForm","setShowAddressForm","addresses","setAddresses","selectedAddress","setSelectedAddress","addressForm","setAddressForm","TAX_RATE","COIN_VALUE","useEffect","jsxs","jsx","response","apiClient","error","addressList","calculateTotals","subtotal","sum","item","itemPrice","tax","maxCoinsUsable","coinsApplied","finalAmount","handleAddressChange","name","handleAddressSubmit","paymentData","a","orderRes","order","options","verifyResult","orderData","placedOrder","failedOrderData","pendingOrder","err","interval","prev","hasDiscount","Fragment","addr"],"mappings":"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"}