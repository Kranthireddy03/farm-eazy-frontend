import{u as Q,i as _,r as c,h as A,j as e}from"./index-BSllqeVN.js";import{P as Y}from"./ProductService-VSwBSLAq.js";function B(){const u=Q(),{showToast:d}=_(),[a,f]=c.useState([]),[x,j]=c.useState(0),[m,k]=c.useState(!1),[i,g]=c.useState(0),[z,J]=c.useState(!1),[v,N]=c.useState(!1),p=1;c.useEffect(()=>{S(),F()},[]);const S=()=>{const s=localStorage.getItem("farmeazy_cart");s&&f(JSON.parse(s))},F=async()=>{try{const s=await A.get("/coins");j(s.data.totalCoins||0)}catch(s){console.error("Error fetching coins:",s),j(0)}},y=s=>{localStorage.setItem("farmeazy_cart",JSON.stringify(s)),f(s),window.dispatchEvent(new Event("cart-updated"))},b=(s,t)=>{if(t<=0){w(s);return}const l=a.find(o=>o.id===s);if(l&&t>l.availableQuantity){d(`Only ${l.availableQuantity} items available in stock`,"warning");return}const r=a.map(o=>o.id===s?{...o,quantity:t}:o);y(r),d("Quantity updated","success")},w=async s=>{const t=a.filter(r=>r.id!==s),l=a.find(r=>r.id===s);if(l)try{await Y.releaseProductQuantity(s,l.quantity)}catch(r){d("Failed to release product: "+(r?.response?.data?.message||r.message),"error")}y(t),d("Product removed from cart and stock restored","success")},P=()=>{const s=a.reduce((o,n)=>{const U=n.discountedPrice!==void 0?n.discountedPrice:n.price;return o+U*n.quantity},0),t=s*.18,l=s+t,r=a.reduce((o,n)=>n.discountedPrice!==void 0&&n.discountedPrice<n.price?o+(n.price-n.discountedPrice)*n.quantity:o,0);return{subtotal:s,tax:t,total:l,savings:r}},{subtotal:O,tax:q,total:h,savings:C}=P(),T=s=>{if(k(s),s){const t=Math.min(x,Math.floor(h));g(t)}else g(0)},E=s=>{const t=Math.min(s,x,Math.floor(h));g(t)},I=Math.max(0,h-i*p),M=async()=>{if(a.length===0){d("Your cart is empty","warning");return}try{N(!0),localStorage.setItem("farmeazy_checkout_coins",JSON.stringify({useCoins:m,coinsToUse:i})),u("/checkout")}catch(s){d("Failed to place order","error"),console.error("Checkout error:",s)}finally{N(!1)}};return a.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 py-8 px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ›’"}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-slate-400 mb-8",children:"Start adding products to your cart to place an order"}),e.jsx("button",{onClick:()=>u("/buying"),className:"bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition",children:"Continue Shopping"})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 py-8 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("button",{onClick:()=>u("/buying"),className:"text-orange-400 hover:text-orange-300 font-semibold mb-4 flex items-center gap-2",children:"â† Back to Shopping"}),e.jsx("div",{className:"text-4xl font-bold text-white",children:"Shopping Cart"}),e.jsxs("p",{className:"text-slate-400",children:[a.length," item(s) in your cart"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-slate-800 rounded-lg shadow-lg overflow-hidden border border-slate-700",children:a.map(s=>e.jsxs("div",{className:"border-b border-slate-700 last:border-b-0 p-6 hover:bg-slate-700/50 transition",children:[e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24 h-24 bg-slate-700 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:s.categoryIcon||"ðŸ“¦"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s.productName}),e.jsxs("p",{className:"text-slate-400 text-sm mb-2",children:["Seller: ",s.sellerFullName]}),s.discountedPrice!==void 0&&s.discountedPrice<s.price?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"text-orange-400 font-bold text-lg",children:["â‚¹",s.discountedPrice.toFixed(2)]}),e.jsxs("span",{className:"line-through text-slate-500 text-base",children:["â‚¹",s.price.toFixed(2)]}),s.discountPercentage&&e.jsxs("span",{className:"bg-green-600 text-white text-xs font-bold px-2 py-0.5 rounded",children:[s.discountPercentage,"% OFF"]})]}),e.jsxs("p",{className:"text-green-400 text-sm font-semibold",children:["You save â‚¹",((s.price-s.discountedPrice)*s.quantity).toFixed(2)]})]}):e.jsxs("p",{className:"text-orange-400 font-bold text-lg",children:["â‚¹",s.price.toFixed(2)]})]}),e.jsx("button",{onClick:()=>w(s.id),className:"text-red-400 hover:text-red-300 text-2xl",children:"ðŸ—‘ï¸"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b(s.id,s.quantity-1),className:"bg-slate-700 hover:bg-slate-600 text-white font-bold px-3 py-1 rounded transition",children:"âˆ’"}),e.jsx("input",{type:"number",value:s.quantity,onChange:t=>b(s.id,parseInt(t.target.value)||1),className:"w-16 text-center border-2 border-slate-600 bg-slate-700 text-white rounded px-2 py-1 font-semibold",min:"1",max:s.availableQuantity}),e.jsx("button",{onClick:()=>b(s.id,s.quantity+1),className:"bg-slate-700 hover:bg-slate-600 text-white font-bold px-3 py-1 rounded transition",children:"+"})]}),e.jsx("div",{className:"text-sm text-slate-400",children:s.availableQuantity>0?e.jsxs("span",{className:"text-green-400 font-semibold",children:[s.availableQuantity," in stock"]}):e.jsx("span",{className:"text-red-400 font-semibold",children:"Out of stock"})}),e.jsxs("div",{className:"ml-auto font-bold text-lg text-white",children:["â‚¹",((s.discountedPrice!==void 0?s.discountedPrice:s.price)*s.quantity).toFixed(2)]})]})]},s.id))})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-lg p-6 sticky top-20 border border-slate-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Order Summary"}),e.jsxs("div",{className:"space-y-4 mb-6 border-b border-slate-600 pb-6",children:[e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"font-semibold text-white",children:["â‚¹",O.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-slate-400",children:[e.jsx("span",{children:"Tax (18% GST):"}),e.jsxs("span",{className:"font-semibold text-white",children:["â‚¹",q.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["â‚¹",h.toFixed(2)]})]}),C>0&&e.jsxs("div",{className:"flex justify-between text-green-400 font-semibold",children:[e.jsx("span",{children:"Discount Savings:"}),e.jsxs("span",{children:["â‚¹",C.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-amber-900/30 to-orange-900/30 rounded-lg p-4 mb-6 border border-amber-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{type:"checkbox",id:"useCoins",checked:m,onChange:s=>T(s.target.checked),className:"w-5 h-5 text-orange-500 rounded cursor-pointer"}),e.jsxs("label",{htmlFor:"useCoins",className:"font-semibold text-white cursor-pointer flex items-center gap-2",children:[e.jsx("span",{children:"ðŸª™ Use Coins"}),e.jsxs("span",{className:"text-sm text-slate-400",children:["(",x," available)"]})]})]}),m&&x>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"range",min:"0",max:Math.min(x,Math.floor(h)),value:i,onChange:s=>E(parseInt(s.target.value)),className:"flex-1 h-2 bg-orange-800 rounded-lg appearance-none cursor-pointer"})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"font-bold text-lg text-orange-400",children:[i," coins = â‚¹",(i*p).toFixed(2)]})})]})]}),e.jsxs("div",{className:"bg-orange-900/40 rounded-lg p-4 mb-6 border border-orange-700/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white",children:"Final Amount:"}),e.jsxs("span",{className:"text-3xl font-bold text-orange-400",children:["â‚¹",I.toFixed(2)]})]}),i>0&&e.jsxs("p",{className:"text-sm text-green-400 mt-2",children:["ðŸ’° You saved â‚¹",(i*p).toFixed(2)," with coins!"]})]}),e.jsx("button",{onClick:M,disabled:v||a.length===0,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-6 rounded-lg transition text-lg",children:v?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"â³"})," Processing..."]}):"âœ“ Proceed to Checkout"}),e.jsx("button",{onClick:()=>u("/buying"),className:"w-full mt-3 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-6 rounded-lg transition",children:"Continue Shopping"})]})})]})]})})}export{B as default};
//# sourceMappingURL=Cart-Bh9k6XVa.js.map
